"use strict";(self.webpackChunkluminescent_team=self.webpackChunkluminescent_team||[]).push([[2517],{3905:(e,t,a)=>{a.d(t,{Zo:()=>s,kt:()=>u});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=r.createContext({}),m=function(e){var t=r.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},s=function(e){var t=m(e.components);return r.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=m(a),u=n,h=d["".concat(p,".").concat(u)]||d[u]||c[u]||i;return a?r.createElement(h,l(l({ref:t},s),{},{components:a})):r.createElement(h,l({ref:t},s))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,l=new Array(i);l[0]=d;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:n,l[1]=o;for(var m=2;m<i;m++)l[m]=a[m];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},3401:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>m});var r=a(7462),n=(a(7294),a(3905));const i={sidebar_position:2},l="Setting Up Ghidra",o={unversionedId:"exefs/ghidra",id:"exefs/ghidra",title:"Setting Up Ghidra",description:"Introduction",source:"@site/rom-hacking/exefs/ghidra.md",sourceDirName:"exefs",slug:"/exefs/ghidra",permalink:"/rom-hacking/exefs/ghidra",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"ROMHackingSidebar",previous:{title:"ExeFS Modding Guide",permalink:"/rom-hacking/exefs/guide"},next:{title:"Setting Up ExLaunch",permalink:"/rom-hacking/exefs/exlaunch"}},p={},m=[{value:"Introduction",id:"introduction",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Importing to Ghidra",id:"importing-to-ghidra",level:2}],s={toc:m};function c(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},s,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"setting-up-ghidra"},"Setting Up Ghidra"),(0,n.kt)("h2",{id:"introduction"},"Introduction"),(0,n.kt)("p",null,"Ghidra is a really useful tool for reverse engineering the code already written for the game. With it we are able to see the instructions called by the game to run and the offsets of those instructions. We use these offsets to tell ExLaunch where to inject our custom code.",(0,n.kt)("br",{parentName:"p"}),"\n","IL2CPPDumper Allows us to automatically assign names to various points in the program such as functions and static data.\n",(0,n.kt)("a",{parentName:"p",href:"https://github.com/dnSpy/dnSpy/releases"},"dnSpy")," is also a very useful tool here as its much more user friendly and allows us to easily find offsets. Just load the dummy DLLs produced by IL2CPPDumper."),(0,n.kt)("h2",{id:"requirements"},"Requirements"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/NationalSecurityAgency/ghidra/releases"},"Ghidra")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/Adubbz/Ghidra-Switch-Loader/releases"},"Ghidra Switch Loader")," or ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/shuffle2/nx2elf"},"nx2elf"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"The Ghidra Switch Loader loads the program with a base address of ",(0,n.kt)("inlineCode",{parentName:"li"},"0x7100000000")," but we can change this pretty easily and its simpler."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/Perfare/Il2CppDumper/releases"},"IL2CPPDumper")),(0,n.kt)("li",{parentName:"ul"},"A Game Dump with exefs and romfs. We need specifically two files.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"main")," from ",(0,n.kt)("inlineCode",{parentName:"li"},"exefs/main")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"global-metadata.dat")," from ",(0,n.kt)("inlineCode",{parentName:"li"},"romfs/Data/Managed/Metadata/global-metadata.dat"))))),(0,n.kt)("h2",{id:"importing-to-ghidra"},"Importing to Ghidra"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Run IL2CPPDumper on ",(0,n.kt)("inlineCode",{parentName:"p"},"main")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"global-metadata.dat")," from the game dump. This will output a bunch of interesting files to ",(0,n.kt)("inlineCode",{parentName:"p"},"il2cpp_dump")," folder. (mainly ",(0,n.kt)("inlineCode",{parentName:"p"},"il2cpp.h"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"script.json")," and a bunch of Dummy DLLs)"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"il2cppdumper.exe main global-metadata.dat il2cpp_dump\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Run the ",(0,n.kt)("inlineCode",{parentName:"p"},"il2cpp_header_to_ghidra.py")," script on ",(0,n.kt)("inlineCode",{parentName:"p"},"il2cpp.h")," outputted from the previous step."),(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Make sure ",(0,n.kt)("inlineCode",{parentName:"p"},"il2cpp_header_to_ghidra.py")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"il2cpp.h")," are in the same folder."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"python il2cpp_header_to_ghidra.py\n"))))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Open Ghidra and create a new project.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Install the Ghidra Switch Loader Plugin."),(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"File > Install Extension > Click the Plus Icon > Select the Ghidra Switch Loader .zip"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Import the ",(0,n.kt)("inlineCode",{parentName:"p"},"main")," file."),(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"File > Import File > Select ",(0,n.kt)("inlineCode",{parentName:"li"},"main")," from game dump"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"double click the imported file to open it in code browser")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Parse C Source ",(0,n.kt)("inlineCode",{parentName:"p"},"il2cpp_ghidra.h")),(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"File > Parse C Source"),(0,n.kt)("li",{parentName:"ol"},"Click the pencil eraser icon to clear the current config"),(0,n.kt)("li",{parentName:"ol"},"Click the plus icon to add the ",(0,n.kt)("inlineCode",{parentName:"li"},"il2cpp_ghidra.h")," file"),(0,n.kt)("li",{parentName:"ol"},"Click Parse to Program"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Run script ",(0,n.kt)("inlineCode",{parentName:"p"},"ghidra_with_struct.py")," with ",(0,n.kt)("inlineCode",{parentName:"p"},"script.json")),(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"Window > Script Manager"),(0,n.kt)("li",{parentName:"ol"},"Click the three lines icon to modify script directories"),(0,n.kt)("li",{parentName:"ol"},"Click the green plus icon to add a new directory"),(0,n.kt)("li",{parentName:"ol"},"Choose the IL2CPPDumper folder that contains all the .py scripts"),(0,n.kt)("li",{parentName:"ol"},"Close the script directories window"),(0,n.kt)("li",{parentName:"ol"},"Click the refresh button at the top right"),(0,n.kt)("li",{parentName:"ol"},"Find the ",(0,n.kt)("inlineCode",{parentName:"li"},"ghidra_with_struct.py")," script from the list and click the green play button to run it"),(0,n.kt)("li",{parentName:"ol"},"When prompted for the ",(0,n.kt)("inlineCode",{parentName:"li"},"script.json")," file, choose the ",(0,n.kt)("inlineCode",{parentName:"li"},"script.json")," file outputted by IL2CPPDumper"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Run Auto Analysis"),(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"Analysis > Auto Analyse main. This will take a long time.")))))}c.isMDXComponent=!0}}]);